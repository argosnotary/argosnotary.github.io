(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{53:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return p}));var r=t(2),o=t(6),a=(t(0),t(98)),i={id:"30_docker_plugin",title:"Docker Plugin",sidebar_label:"Docker Plugin"},c={unversionedId:"65_extensions/30_docker_plugin",id:"65_extensions/30_docker_plugin",isDocsHomePage:!1,title:"Docker Plugin",description:"This is page is work in progress",source:"@site/docs/65_extensions/30_docker_plugin.md",slug:"/65_extensions/30_docker_plugin",permalink:"/docs/65_extensions/30_docker_plugin",editUrl:"https://github.com/argosnotary/docs/tree/master/docs/65_extensions/30_docker_plugin.md",version:"current",sidebar_label:"Docker Plugin",sidebar:"docs",previous:{title:"XL Deploy Plugin",permalink:"/docs/65_extensions/20_xldeploy_plugin"},next:{title:"Terminology",permalink:"/docs/70_reference/10_terminology"}},s=[{value:"Plugin location",id:"plugin-location",children:[]},{value:"Useage",id:"useage",children:[]}],l={rightToc:s};function p(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(a.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(a.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(a.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(a.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(a.b)("p",{parentName:"div"},"This is page is work in progress"))),Object(a.b)("h2",{id:"plugin-location"},"Plugin location"),Object(a.b)("p",null,"source code:\n",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/argosnotary/argos4j-cli"}),"https://github.com/argosnotary/argos4j-cli")),Object(a.b)("p",null,"docker base image:\nargosnotary/argos4j-cli:latest"),Object(a.b)("h2",{id:"useage"},"Useage"),Object(a.b)("p",null,'You can use this docker base image in any docker multistage build image of choice this way you can "wrap" your build commands with argos4j cli.'),Object(a.b)("p",null,"This is illustrated in the project example ArgosBuildWithArgosWrapper docker file ArgosBuildWithArgosWrapper."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"    FROM argosnotary/argos4j-cli:latest as argosWrapper\n    FROM argosnotary/argos-build:latest\n    COPY --from=argosWrapper /usr/local/lib/argos /usr/local/lib/argos\n    RUN cd /usr/bin && ln -s /usr/local/lib/argos/bin/postLink\n")),Object(a.b)("p",null,'In the example above the docker argos4j-cli is fetched from the dockerhub repository and used in the build image of argos notary.\nThe argos4j-cli docker image contains a sh or bat script to use  located in /usr/local/lib/argos.\nThe executable script is called "postLink" the last command is used to create a soft link so it can be called without the path.'),Object(a.b)("p",null,"The following docker environment variables can be used in any build step to connect to an argosnotary service instance."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),'\nWORKSPACE: the workspace of your ci cd pipeline setup eg "/drone/src"\nARGOS_SERVICE_BASE_URL: the url of the argosnotary service eg "https://notary.argosnotary.org/api"\nCREDENTIALS_PASSPHRASE: the passphrase of the service account key configured in argosnotary.\nCREDENTIALS_KEY_ID: the keyId of the service account key configured in argosnotary.\nSUPPLY_CHAIN_NAME: your supplychain name configured in argosnotary eg "argos-test-app"\nSUPPLY_CHAIN_PATH : the label path to your supplychain configured in argosnotary eg "com.rabobank"\nRUN_ID : bcdd4bf0245c82c060407b3b24b9b87301d15ac1\n\n')),Object(a.b)("p",null,"Commands can then be wrapped to collect materials and products and send sent link files to argosnotary."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"       - postLink --phase pre --segment jenkins --step build --runId $RUN_ID\n       - mvn -s settings.xml install\n       - postLink --phase post --segment jenkins --step build --runId $RUN_ID\n\n")),Object(a.b)("p",null,"The first command before the build command (--phase pre)  is used to make a snapshot of the pipeline workspace before the main command is executed.\nIt collects the materials and stores a signed link in the workspace."),Object(a.b)("p",null,"The second command (--phase post)  is executed after the main command, it makes a new snapshot of the workspace and sends the stored link file to the argos service."),Object(a.b)("p",null,"Complete example for drone ci:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{}),"   - name: build\n     image:argosnotary/argosbuild-argos4j-cli:latest\n     volumes:\n       - name: mvn_cache\n         path: /root/.m2/repository\n     environment:\n       WORKSPACE: /drone/src\n       ARGOS_SERVICE_BASE_URL: http://192.168.2.2:8080/api\n       CREDENTIALS_PASSPHRASE:\n         from_secret: argos-service-account-pw\n       CREDENTIALS_KEY_ID:\n         from_secret: argos-service-account-key-id\n       SUPPLY_CHAIN_NAME: argos-test-app\n       SUPPLY_CHAIN_PATH : com.rabobank\n       DRONE_COMMIT : bcdd4bf0245c82c060407b3b24b9b87301d15ac1\n     commands:\n       - postLink --phase pre --segment drone --step build --runId $DRONE_COMMIT\n       - mvn -s settings.xml install\n       - postLink --phase post --segment drone --step build --runId $DRONE_COMMIT\n")))}p.isMDXComponent=!0},98:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return g}));var r=t(0),o=t.n(r);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=o.a.createContext({}),p=function(e){var n=o.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},u=function(e){var n=p(e.components);return o.a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},b=o.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(t),b=r,g=u["".concat(i,".").concat(b)]||u[b]||d[b]||a;return t?o.a.createElement(g,c(c({ref:n},l),{},{components:t})):o.a.createElement(g,c({ref:n},l))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=b;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<a;l++)i[l]=t[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);